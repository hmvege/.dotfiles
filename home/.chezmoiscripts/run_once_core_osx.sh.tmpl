{{ if (eq .chezmoi.os "darwin") -}}
#!/bin/bash

# Set to catch non-zero exit status errors, variable errors or pipeline
# failures.
set -euo pipefail

# Starts by installing basic developer tools for OSX
xcode-select --install

packages=(
    bat
    fasd
    fd
    fzf
    git
    htop
    jq
    lsd
    node  # Needed by LSP
    pipx
    pyenv
    pyenv-virtualenv
    tmux
    unzip
    vim
    wget
    zsh
    # # Required by Brew
    # openssl
    # readline
    # sqlite3
    # xz
    # zlib
)

## Brew
if ! type -p brew >/dev/null 2>&1
then
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    echo "Installed Brew"
else
    echo "Brew is already installed"
fi

## Verifying Brew install
brew doctor

for pkg in ${packages[@]}
do
    sudo brew install -y $pkg
done

## Once again, verifying Brew install
brew doctor

python_global="3.9.11"

if type -p "$pyenv" >/dev/null 2>&1
then
    echo "pyenv exists: proceeding to check if global python is set to $python_global"
    if ! pyenv which python | grep -q $python_global
    then
        echo "Setting up pyenv globals"
        pyenv install $python_global
        pyenv install 3.10.3
        pyenv global $python_global
    else
        echo "Global Python is already set to $python_global"
    fi
fi


## fzf installation completion
$(brew --prefix)/opt/fzf/install

if [ ! -d ~/.oh-my-zsh ]
then
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
fi

## Workaround for fuzzy-find alt+c: https://github.com/junegunn/fzf/issues/164
bindkey "รง" fzf-cd-widget

## vim plugin manager
if [ ! -d "${HOME}/.vim/autoload/plug.vim" ]
then
    curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
        https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    echo "vim plugin manager installed"
else
    echo "vim plugin manager already installed"
fi

{{ end -}}
